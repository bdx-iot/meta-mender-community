header:
    version: 2

target: core-image-base

repos:
    meta-mender:
        url: https://github.com/mendersoftware/meta-mender
        refspec: zeus
        layers:
            meta-mender-core:
            meta-mender-demo:

bblayers_conf_header:
    standard: |
        POKY_BBLAYERS_CONF_VERSION = "2"
        BBPATH = "${TOPDIR}"
        BBFILES ?= ""
local_conf_header:
    reduce_diskspace: |
        # This really saves a lot of disk space!
        INHERIT += "rm_work"
    mender: |
        # The name of the disk image and Artifact that will be built.
        # This is what the device will report that it is running, and different updates
        # must have different names because Mender will skip installation of an Artifact
        # if it is already installed.
        MENDER_ARTIFACT_NAME = "release-1"

        INHERIT += "mender-full"
    systemd: |
        VIRTUAL-RUNTIME_init_manager = "systemd"
        DISTRO_FEATURES_BACKFILL_CONSIDERED = "sysvinit"
        VIRTUAL-RUNTIME_initscripts = ""
        DISTRO_FEATURES_append = " systemd"
    hosted-mender: |
        # Build for Hosted Mender
        #
        # To get your tenant token:
        #    - log in to https://hosted.mender.io
        #    - click your email at the top right and then "My organization"
        #    - press the "COPY TO CLIPBOARD"
        #    - assign content of clipboard to MENDER_TENANT_TOKEN
        #
        #MENDER_SERVER_URL = "https://hosted.mender.io"
        #MENDER_TENANT_TOKEN = ""
    mender-demo: |
        # Build for Mender demo server
        #
        # https://docs.mender.io/getting-started/create-a-test-environment
        #
        # Uncomment below and update IP address to match the machine running the
        # Mender demo server
        #MENDER_DEMO_HOST_IP_ADDRESS = "192.168.0.100"
    mender-server-on-prem: |
        # Build for Mender production setup (on-prem)
        #
        # https://docs.mender.io/artifacts/building-for-production
        #
        # Uncomment below and update the URL to match your configured domain
        # name and provide the path to the generated server.crt file.
        #
        # NOTE! It is recommend that you provide below information in your custom
        # Yocto layer and this is only for demo purposes. See linked documentation
        # for additional information.
        #MENDER_SERVER_URL = "https://docker.mender.io"
        #FILESEXTRAPATHS_prepend_pn-mender := "<DIRECTORY-CONTAINING-server.crt>:"
        #SRC_URI_append_pn-mender = " file://server.crt"

    standard: |
        CONF_VERSION = "1"
        PACKAGE_CLASSES = "package_rpm"
        SDKMACHINE = "x86_64"
        USER_CLASSES = "buildstats image-mklibs image-prelink"
        PATCHRESOLVE = "noop"
    debug-tweaks: |
        EXTRA_IMAGE_FEATURES = "debug-tweaks"
    diskmon: |
        BB_DISKMON_DIRS = "\
            STOPTASKS,${TMPDIR},1G,100K \
            STOPTASKS,${DL_DIR},1G,100K \
            STOPTASKS,${SSTATE_DIR},1G,100K \
            STOPTASKS,/tmp,100M,100K \
            ABORT,${TMPDIR},100M,1K \
            ABORT,${DL_DIR},100M,1K \
            ABORT,${SSTATE_DIR},100M,1K \
            ABORT,/tmp,10M,1K"
